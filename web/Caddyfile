{
	auto_https disable_redirects
	https_port 443
}

{$DOMAIN_NAME:https://ubuntu.swallow-cliff.ts.net:443} {
	# API reverse proxy - strip /api prefix
	handle /api/* {
		uri strip_prefix /api
		reverse_proxy 127.0.0.1:3060
	}

	# Static file serving with caching
	handle {
		root * /srv
		
		# Immutable cache for hashed assets
		@immutable {
			path /assets/* *.js *.css *.woff2
		}
		header @immutable Cache-Control "public, max-age=31536000, immutable"
		
		# No cache for index.html and service worker
		@nocache {
			path /index.html /sw.js
		}
		header @nocache Cache-Control "no-cache, no-store, must-revalidate"
		
		# SPA fallback
		try_files {path} /index.html
		file_server
	}
}
